<!DOCTYPE html>
<html lang="en">
<head>
    <script>
(function () {
  const WORKSPACE_ID = "ws_demo";
  const ENDPOINT = "http://localhost:3000/api/events";

  function newUUID() {
    try {
      if (typeof crypto !== "undefined" && crypto.randomUUID) return crypto.randomUUID();
    } catch {}
    // v4-like fallback
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
      const r = Math.random() * 16 | 0;
      const v = c === 'x' ? r : (r & 0x3) | 0x8;
      return v.toString(16);
    });
  }

  const VID_KEY = "sa_vid";
  function getVisitorId() {
    try {
      let v = localStorage.getItem(VID_KEY);
      if (!v) { v = newUUID(); localStorage.setItem(VID_KEY, v); }
      return v;
    } catch { return newUUID(); }
  }

  function send(payload, retries = 2) {
    return fetch(ENDPOINT, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      keepalive: true
    }).catch(() => {
      if (retries > 0) {
        const waitMs = (3 - retries) * 500;
        setTimeout(() => send(payload, retries - 1), waitMs);
      }
    });
  }

  const queue = [];
  const BATCH_MS = 600;
  const BATCH_MAX = 12;
  const INTERVAL_MS = 10000;
  let timer = null;
  let intervalId = null;

  function enqueue(ev) {
    queue.push(ev);
    if (queue.length >= BATCH_MAX) return flush();
    if (!timer) timer = setTimeout(flush, BATCH_MS);
  }

  function flush(final = false) {
    if (timer) { clearTimeout(timer); timer = null; }
    if (!queue.length) return;
    const batch = { workspaceId: WORKSPACE_ID, events: queue.splice(0, queue.length)}

    if (final) {
      fetch(ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(batch),
        keepalive: true
      }).catch(() => {});
      return;
    }
    send(batch, 2);
  }

  intervalId = setInterval(() => { flush(); }, INTERVAL_MS);

  function base(type, elementId) {
    return {
      eventId: newUUID(),
      type,
      workspaceId: WORKSPACE_ID,
      visitorId: getVisitorId(),
      occurredAt: new Date().toISOString(),
      pageUrl: location.href,
      refferUrl: document.referrer || undefined,
      elementId: elementId || undefined
    };
  }

  enqueue({ ...base("TRACK") });
  enqueue({ ...base("PAGE") });
  flush();

  document.addEventListener("blur", (e) => {
    const el = e.target;
    if (!(el instanceof HTMLInputElement)) return;
    if (el.type !== "email") return;
    const val = (el.value || "").trim();
    if (/.+@.+..+/.test(val)) enqueue({ ...base("TRACK", el.id || "email-input") });
  }, true);

  document.addEventListener("click", (e) => {
    const el = e.target;
    if (!(el instanceof Element)) return;
    let id = el.getAttribute("id");
    if (!id && el.tagName === "BUTTON") {
      id = "button:" + (el.getAttribute("type") || "button").toLowerCase();
    }
    if (id) enqueue({ ...base("CLICK", id) });
  }, true);

  function cleanupAndFlush() {
    if (intervalId) clearInterval(intervalId);
    flush(true);
  }
  window.addEventListener("pagehide", cleanupAndFlush);
  document.addEventListener("visibilitychange", () => {
    if (document.visibilityState === "hidden") cleanupAndFlush();
  });
})();
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome to Our Company</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        .hero {
            background-color: #3498db;
            color: white;
            padding: 50px 20px;
            text-align: center;
        }
        .hero h1 {
            margin: 0;
            font-size: 2.5em;
        }
        .content {
            max-width: 600px;
            margin: 20px auto;
            padding: 20px;
        }
        form {
            display: flex;
            flex-direction: column;
        }
        label {
            margin-top: 10px;
        }
        input, select {
            margin-bottom: 15px;
            padding: 5px;
        }
        button {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 10px;
            cursor: pointer;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2980b9;
        }
        .additional-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .additional-buttons button {
            flex: 1;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <div class="hero">
        <h1>Welcome to Our Company</h1>
        <p>We're excited to hear from you!</p>
    </div>
    <div class="content">
        <form action="" method="get">
            <label for="name">Name:</label>
            <input type="text" id="name" name="name" required>

            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>

            <label for="company-size">Company Size:</label>
            <select id="company-size" name="company-size" required>
                <option value="">Select an option</option>
                <option value="1-10">1-10 employees</option>
                <option value="11-50">11-50 employees</option>
                <option value="51-200">51-200 employees</option>
                <option value="201+">201+ employees</option>
            </select>

            <button type="submit">Submit</button>
        </form>

        <div class="additional-buttons">
            <button>Follow Us</button>
            <button>Log In</button>
        </div>
    </div>
</body>
</html>
